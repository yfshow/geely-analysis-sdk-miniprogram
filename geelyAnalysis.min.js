!function(){"use strict";var e={},t=Array.isArray,i=Object.prototype,r=Array.prototype,n=r.forEach,a=r.indexOf,s=i.toString,o=i.hasOwnProperty,u=r.slice,c=function(e,t,i){if(null==e)return!1;var r={};if(n&&e.forEach===n)e.forEach(t,i);else if(e.length===+e.length){for(var a=0,s=e.length;a<s;a++)if(a in e&&t.call(i,e[a],a,e)===r)return!1}else for(var u in e)if(o.call(e,u)&&t.call(i,e[u],u,e)===r)return!1};function p(e){return null!=e&&"[object Object]"==s.call(e)}var d,_=(d=(new Date).getTime(),function(e){return Math.ceil((d=(9301*d+49297)%233280)/233280*e)});function l(){if("function"==typeof Uint32Array){var e="";if("undefined"!=typeof crypto?e=crypto:"undefined"!=typeof msCrypto&&(e=msCrypto),p(e)&&e.getRandomValues){var t=new Uint32Array(1);return e.getRandomValues(t)[0]/Math.pow(2,32)}}return _(1e19)/1e19}function f(e){return c(u.call(arguments,1),(function(t){for(var i in t)void 0!==t[i]&&(e[i]=t[i])})),e}var h=t||function(e){return"[object Array]"===s.call(e)};function g(e){return!(!e||!o.call(e,"callee"))}function m(e){var t=[];return null==e||c(e,(function(e){t[t.length]=e})),t}var y=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},v=Number.isSafeInteger||function(e){return y(e)&&Math.abs(e)<=Math.pow(2,53)-1},S={each:c,isObject:p,getRandomBasic:_,getRandom:l,extend:f,extend2Lev:function(e){return c(u.call(arguments,1),(function(t){for(var i in t)void 0!==t[i]&&null!==t[i]&&(p(t[i])&&p(e[i])?f(e[i],t[i]):e[i]=t[i])})),e},coverExtend:function(e){return c(u.call(arguments,1),(function(t){for(var i in t)void 0!==t[i]&&void 0===e[i]&&(e[i]=t[i])})),e},isArray:h,isFunction:function(e){if(!e)return!1;var t=Object.prototype.toString.call(e);return"[object Function]"==t||"[object AsyncFunction]"==t},isArguments:g,toArray:function(e){return e?e.toArray?e.toArray():h(e)||g(e)?u.call(e):m(e):[]},values:m,include:function(e,t){var i=!1;return null==e?i:a&&e.indexOf===a?-1!=e.indexOf(t):(c(e,(function(e){if(i||(i=e===t))return{}})),i)},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},isEmptyObject:function(e){if(p(e)){for(var t in e)if(o.call(e,t))return!1;return!0}return!1},deepCopy:function(e){var t={};return function e(t,i){for(var r in i){var n=i[r];h(n)?(t[r]=[],e(t[r],n)):p(n)?(t[r]={},e(t[r],n)):t[r]=n}}(t,e),t},isUndefined:function(e){return void 0===e},isString:function(e){return"[object String]"==s.call(e)},isDate:function(e){return"[object Date]"==s.call(e)},isBoolean:function(e){return"[object Boolean]"==s.call(e)},isNumber:function(e){return"[object Number]"==s.call(e)&&/[\d\.]+/.test(String(e))},isJSONString:function(e){try{JSON.parse(e)}catch(e){return!1}return!0},isInteger:y,isSafeInteger:v,slice:u},$={};function b(t){t=JSON.stringify(t);var i=e._.base64Encode(t);return encodeURIComponent(i)}$.buildData=function(t,i){var r={distinct_id:e.store.getDistinctId(),identities:e.store._state.identities,lib:{$lib:e.lib_name,$lib_method:"code",$lib_version:e.lib_version},properties:{}};return"track_id_unbind"===t.type&&"$UnbindID"===t.event&&(r.identities=S.deepCopy(t.unbind_value),delete t.unbind_value),S.isObject(i)||(i={}),S.extend(r,e.store.getUnionId(),t),S.isObject(t.properties)&&!S.isEmptyObject(t.properties)&&S.extend(r.properties,t.properties),t.type&&"profile"===t.type.slice(0,7)||(r._track_id=Number(String(l()).slice(2,5)+String(l()).slice(2,4)+String(Date.now()).slice(-4)),r.properties=S.extend({},S.info.properties,e.store.getProps(),S.info.currentProps,i,r.properties),"track"===t.type&&(r.properties.$is_first_day=S.getIsFirstDay()),function(t){if(t&&t.properties){var i=e._.getRefPage(),r=e._.getCurrentPageInfo(),n={$referrer:i.route,$referrer_title:i.title,$title:r.title,$url:r.url};for(var a in!0===e.para.preset_properties.url_path&&(n.$url_path=r.path),n)t.properties.hasOwnProperty(a)||(t.properties[a]=n[a])}}(r)),r.properties.$time&&S.isDate(r.properties.$time)?(r.time=1*r.properties.$time,delete r.properties.$time):r.time=1*new Date,S.parseSuperProperties(r.properties),S.searchObjDate(r),S.searchObjString(r),r},$.processData=function(e){return e},$.onceTrackData=function(e){return"data="+b(e)},$.batchTrackData=function(e){var t=Date.now();return e.forEach((function(e){e._flush_time=t})),"data_list="+b(e)},$.onEventSend=function(){return{}};var P={getData:function(t){wx.getStorage({key:e.para.storage_prepare_data_key,complete:function(i){var r=i.data&&e._.isArray(i.data)?i.data:[];P.deleteAesData(r),t&&t()}})},deleteAesData:function(t){var i=[],r=t.length;if(r>0){for(var n=0;n<r;n++)e._.isObject(t[n])&&i.push(t[n]);e.store.mem.mdata=i.concat(e.store.mem.mdata)}}},O={dataHasSend:!0,dataHasChange:!1,syncStorage:!1,failTime:0,init:function(){P.getData(O.syncStorageState),O.batchInterval()},syncStorageState:function(){O.syncStorage=!0},onAppHide:function(){e.para.batch_send&&this.batchSend()},send:function(t){this.dataHasChange=!0,e.store.mem.getLength()>=500&&(e._.logger.info("数据量存储过大，有异常"),e.store.mem.mdata.shift()),(t=$.processData(t))&&e.store.mem.add(t),e.store.mem.getLength()>=e.para.batch_send.max_length&&this.batchSend()},wxrequest:function(t){if(e._.isArray(t.data)&&t.data.length>0){var i=t.data;e._.wxrequest({url:e.para.server_url,method:"POST",dataType:"text",data:i,success:function(){t.success(t.len)},fail:function(){t.fail()}})}else t.success(t.len)},batchSend:function(){if(this.dataHasSend){var t,i,r=e.store.mem.mdata;(i=(t=r.length>=100?r.slice(0,100):r).length)>0&&(this.dataHasSend=!1,this.wxrequest({data:t,len:i,success:this.batchRemove.bind(this),fail:this.sendFail.bind(this)}))}},sendFail:function(){this.dataHasSend=!0,this.failTime++},batchRemove:function(t){e.store.mem.clear(t),this.dataHasSend=!0,this.dataHasChange=!0,this.batchWrite(),this.failTime=0},is_first_batch_write:!0,batchWrite:function(){var t=this;this.dataHasChange&&(this.is_first_batch_write&&(this.is_first_batch_write=!1,setTimeout((function(){t.batchSend()}),1e3)),this.dataHasChange=!1,this.syncStorage&&e._.setStorageSync(e.para.storage_prepare_data_key,e.store.mem.mdata))},batchInterval:function(){var t=this;!function e(){setTimeout((function(){t.batchWrite(),e()}),500)}(),function i(){setTimeout((function(){t.batchSend(),i()}),e.para.batch_send.send_timeout*Math.pow(2,t.failTime))}()}};function I(t){t._flush_time=Date.now();var i=function(e,t){var i=$.onceTrackData(t);return-1!==e.indexOf("?")?e+"&"+i:e+"?"+i}(e.para.server_url,t);e._.wxrequest({url:i,method:"GET"})}var k={send:function(t,i){if(!e.para.server_url)return e._.logger.info("error: server_url 不能为空"),!1;if(e.current_scene&&1154===e.current_scene&&!e.para.preset_events.moments_page)return!1;var r=e._.deepCopy(t),n=e.kit.onEventSend(r),a=e.kit.buildData(t,n);if(a){let t=w(a,r);k.debug(t),e.events.emit("send",t),e.para.batch_send?O.send(t):I(t)}else e._.logger.info("error: 数据异常 "+a)},debug:function(t){e._.logger.info(t)}},C={init_status:!1,life_state:{app_launched:!1},plugin:{init_list:[],uninitialized_list:[]},privacy:{enable_data_collect:!1},mp_hook:{data:1,onLoad:1,onShow:1,onReady:1,onPullDownRefresh:1,onShareAppMessage:1,onShareTimeline:1,onReachBottom:1,onPageScroll:1,onResize:1,onTabItemTap:1,onHide:1,onUnload:1},user:{LOGIN_ID_KEY:"$identity_login_id"}};e.popupEmitter={attached:function(){return!1}};var w=function(t,i){const r={$MPLaunch:"$MPLaunch",$MPShow:"enter",$MPHide:"$MPHide",$MPViewScreen:"ep",$MPShare:"$MPShare",$MPClick:"$MPClick",$MPAddFavorites:"$MPAddFavorites",$MPPageLeave:"back"};let n=Object.keys(r).indexOf(t.event)>0,a=n?r[t.event]:t.event,s=n?"auto":"track";console.log("原始数据",t);let o={ts:t.time,config:{app_id:t.properties.$app_id,app_platform:"MiniP",app_scope:"2",type:"frontend",source:"",vc:"1.1"},common:{uid:t.login_id||"",username:e.store.storageInfo?.history_login_id?.userName||"",visitor_id:e.store.visitor_id,session_id:e.store.session_id},event:{event_id:a,event_type:s}};const u={...i.properties,page_id:t.properties.$url_path},c={user_agent:"",refer:t.properties.$referrer,refer_title:t.properties.$title,page_url:t.properties.$url_path,page_title:t.properties.$title,prev_page_id:t.properties.$referrer,page_id:t.properties.$url_path};return n?o.page=c:o.properties=u,o};function T(){var e;return global&&global.sensors_data_pre_config&&(e=!!global.sensors_data_pre_config.is_compliance_enabled&&global.sensors_data_pre_config.is_compliance_enabled),!e||(!!C.init_status||!!C.privacy.enable_data_collect)}function x(t,i,r){var n=e.autoTrackCustom[r];if(t[i]){var a=t[i];t[i]=function(){!e.para.autoTrackIsFirst||p(e.para.autoTrackIsFirst)&&!e.para.autoTrackIsFirst[r]?(a.apply(this,arguments),n.apply(this,arguments)):(!0===e.para.autoTrackIsFirst||p(e.para.autoTrackIsFirst)&&e.para.autoTrackIsFirst[r])&&(n.apply(this,arguments),a.apply(this,arguments))}}else t[i]=function(){n.apply(this,arguments)}}function j(t){var i={},r={},n="",a=t.currentTarget||{},s=t.target||{};if(p(e.para.framework)&&p(e.para.framework.taro)&&!e.para.framework.taro.createApp&&s.id&&a.id&&s.id!==a.id)return!1;var o=a.dataset||{};if(n=t.type,i.$element_id=a.id,i.$element_type=o.type,i.$element_content=o.content,i.$element_name=o.name,p(t.event_prop)&&(r=t.event_prop),n&&q(n)){if(e.para.preset_events&&e.para.preset_events.collect_element&&!1===e.para.preset_events.collect_element(arguments[0]))return!1;i.$url_path=e._.getCurrentPath(),e._.setPageRefData(i),i=e._.extend(i,r),e.track("$MPClick",i)}}function D(t,i){var r=t[i];t[i]=function(){var t=r.apply(this,arguments),i=arguments[0];return p(i)&&(e.para.preset_events.defer_track?setTimeout((function(){j(i)}),0):j(i)),t}}function q(e){return!!{tap:1,longpress:1,longtap:1}[e]}function A(t){var i=[];if(e.para.autoTrack&&e.para.autoTrack.mpClick){i=function(e){var t=C.mp_hook,i=[];for(var r in e)"function"!=typeof e[r]||t[r]||i.push(r);return i}(t),function(t){var i=t.onTabItemTap;t.onTabItemTap=function(t){i&&i.apply(this,arguments);var r={};t&&(r.$element_content=t.text),r.$element_type="tabBar",r.$url_path=e._.getCurrentPath(),e._.setPageRefData(r),e.track("$MPClick",r)}}(t);for(var r=i.length,n=0;n<r;n++)D(t,i[n])}}function U(t){e.para.autoTrack&&e.para.autoTrack.pageLeave&&function(t){var i=t.onHide;t.onHide=function(){i&&i.apply(this,arguments),e._.sendPageLeave()};var r=t.onUnload;t.onUnload=function(){r&&r.apply(this,arguments),e._.sendPageLeave()}}(t),x(t,"onLoad","pageLoad"),x(t,"onShow","pageShow"),x(t,"onAddToFavorites","pageAddFavorites"),"function"==typeof t.onShareAppMessage&&e.autoTrackCustom.pageShare(t),"function"==typeof t.onShareTimeline&&e.autoTrackCustom.pageShareTimeline(t)}function L(t,i){return t!==e.store._state.history_login_id.name||e.store._state.history_login_id.value!==i}function E(t){var i=e.store.getFirstId(),r=e.store.getDistinctId();return i?t===i:t===r}function F(e,t){var i=["$identity_anonymous_id","$mp_openid","$identity_mp_openid","$identity_mp_unionid","$mp_unionid"];for(var r of(h(t)&&(i=i.concat(t)),i))if(r===e)return!0;return!1}e.kit=$,e.mergeStorageData=P,e.saEvent=k,e.sendStrategy=O,e._=S,e.IDENTITY_KEY={EMAIL:"$identity_email",MOBILE:"$identity_mobile"},e.usePlugin=function(t,i){if(t&&t.info&&"miniprogram_abtesting"===t.info.lib_plugin_name)return"function"==typeof t.init&&t.init(e,i),!1;if(C.init_status)"function"==typeof t.init&&t.init(e,i);else{var r={target:t,para:i};C.plugin.uninitialized_list.push(r)}},e.checkPluginInitStatus=function(){if(C.plugin.uninitialized_list.length>0){for(var t in C.plugin.uninitialized_list){var i=C.plugin.uninitialized_list[t];i&&i.target&&"function"==typeof i.target.init&&i.target.init(e,i.para)}C.plugin.uninitialized_list=[]}},e.enableDataCollect=function(){C.privacy.enable_data_collect=!0},e.para={name:"sensors",server_url:"",send_timeout:1e3,show_log:!1,login_id_key:"$identity_login_id",allow_amend_share_path:!0,max_string_length:500,datasend_timeout:3e3,source_channel:[],autoTrack:{appLaunch:!0,appShow:!0,appHide:!0,pageShow:!0,pageShare:!0,mpClick:!1,mpFavorite:!0,pageLeave:!1},autotrack_exclude_page:{pageShow:[],pageLeave:[]},is_persistent_save:{share:!1,utm:!1},preset_properties:{url_path:!0},preset_events:{moments_page:!1,defer_track:!1,share_info_use_string:!1},batch_send:!0,storage_store_key:"sensorsdata2015_wechat",storage_prepare_data_key:"sensors_mp_prepare_data"};var M="object"==typeof M?M:{};M.info=function(){if(e.para.show_log&&"object"==typeof console&&console.log)try{if(3===arguments.length)return console.log(arguments[0],arguments[1],arguments[2]);if(2===arguments.length)return console.log(arguments[0],arguments[1]);if(1===arguments.length)return console.log(arguments[0])}catch(e){console.log(arguments[0])}},S.logger=M,e.setPara=function(t){e.para=S.extend2Lev(e.para,t);var i=[];if(S.isArray(e.para.source_channel))for(var r=e.para.source_channel.length,n=0;n<r;n++)-1===" utm_source utm_medium utm_campaign utm_content utm_term sa_utm ".indexOf(" "+e.para.source_channel[n]+" ")&&i.push(e.para.source_channel[n]);e.para.source_channel=i,S.isObject(e.para.register)&&S.extend(S.info.properties,e.para.register),e.para.openid_url||(e.para.openid_url=e.para.server_url.replace(/([^\/])\/(sa)(\.gif){0,1}/,"$1/mp_login")),"number"!=typeof e.para.send_timeout&&(e.para.send_timeout=1e3);var a={send_timeout:6e3,max_length:6};t&&t.datasend_timeout||e.para.batch_send&&(e.para.datasend_timeout=1e4),!0===e.para.batch_send?e.para.batch_send=S.extend({},a):S.isObject(e.para.batch_send)&&(e.para.batch_send=S.extend({},a,e.para.batch_send));var s={share:!1,utm:!1};!0===e.para.is_persistent_save?(e.para.is_persistent_save=S.extend({},s),e.para.is_persistent_save.utm=!0):S.isObject(e.para.is_persistent_save)&&(e.para.is_persistent_save=S.extend({},s,e.para.is_persistent_save)),e.para.server_url?(e.para.preset_properties=S.isObject(e.para.preset_properties)?e.para.preset_properties:{},S.isObject(e.para.autotrack_exclude_page)||(e.para.autotrack_exclude_page={pageShow:[],pageLeave:[]}),S.isArray(e.para.autotrack_exclude_page.pageShow)||(e.para.autotrack_exclude_page.pageShow=[]),S.isArray(e.para.autotrack_exclude_page.pageLeave)||(e.para.autotrack_exclude_page.pageLeave=[])):M.info("请使用 setPara() 方法设置 server_url 数据接收地址,详情可查看https://www.sensorsdata.cn/manual/mp_sdk_new.html#112-%E5%BC%95%E5%85%A5%E5%B9%B6%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0")},e.getServerUrl=function(){return e.para.server_url};var R="1.17.10",N="MiniProgram",K=["$latest_utm_source","$latest_utm_medium","$latest_utm_campaign","$latest_utm_content","$latest_utm_term","$latest_sa_utm"],B=["$latest_share_distinct_id","$latest_share_url_path","$latest_share_depth","$latest_share_method"],H=["sensors_share_d","sensors_share_p","sensors_share_i","sensors_share_m"],V=Date.now(),Q=null,z=0,J="",Y="",G="",W=!1,Z="";e.lib_version=R,e.lib_name=N;var X,ee,te,ie={},re=[];S.decodeURIComponent=function(e){var t="";try{t=decodeURIComponent(e)}catch(i){t=e}return t},S.encodeDates=function(e){return S.each(e,(function(t,i){S.isDate(t)?e[i]=S.formatDate(t):S.isObject(t)&&(e[i]=S.encodeDates(t))})),e},S.formatDate=function(e){function t(e){return e<10?"0"+e:e}return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())},S.searchObjDate=function(e){S.isObject(e)&&S.each(e,(function(t,i){S.isObject(t)?S.searchObjDate(e[i]):S.isDate(t)&&(e[i]=S.formatDate(t))}))},S.formatString=function(t){return t.length>e.para.max_string_length?(M.info("字符串长度超过限制，已经做截取--"+t),t.slice(0,e.para.max_string_length)):t},S.searchObjString=function(e){S.isObject(e)&&S.each(e,(function(t,i){S.isObject(t)?S.searchObjString(e[i]):S.isString(t)&&(e[i]=S.formatString(t))}))},S.parseSuperProperties=function(e){S.isObject(e)&&(S.each(e,(function(t,i){if(S.isFunction(t))try{e[i]=t(),S.isFunction(e[i])&&(M.info("您的属性- "+i+" 格式不满足要求，我们已经将其删除"),delete e[i])}catch(t){delete e[i],M.info("您的属性- "+i+" 抛出了异常，我们已经将其删除")}})),S.strip_sa_properties(e))},S.unique=function(e){for(var t,i=[],r={},n=0;n<e.length;n++)(t=e[n])in r||(r[t]=!0,i.push(t));return i},S.check={checkKeyword:function(e){return/^((?!^distinct_id$|^original_id$|^device_id$|^time$|^properties$|^id$|^first_id$|^second_id$|^users$|^events$|^event$|^user_id$|^date$|^datetime$|^user_group|^user_tag)[a-zA-Z_$][a-zA-Z\d_$]{0,99})$/i.test(e)},ckeckIdLength:function(e){return!(String(e).length>255)||(M.info("id 长度超过 255 个字符！"),!1)}},S.strip_sa_properties=function(e){return S.isObject(e)?(S.each(e,(function(t,i){if(S.isArray(t)){var r=[];S.each(t,(function(e){S.isString(e)?r.push(e):M.info("您的数据-",t,"的数组里的值必须是字符串,已经将其删除")})),e[i]=r}S.isString(t)||S.isNumber(t)||S.isDate(t)||S.isBoolean(t)||S.isArray(t)||(M.info("您的数据 - "+i+":"+t+" - 格式不满足要求，已经将其删除"),delete e[i])})),e):e},S.strip_empty_properties=function(e){var t={};return S.each(e,(function(e,i){null!=e&&(t[i]=e)})),t},S.utf8Encode=function(e){var t,i,r,n,a="";for(t=i=0,r=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,n=0;n<r;n++){var s=e.charCodeAt(n),o=null;s<128?i++:o=s>127&&s<2048?String.fromCharCode(s>>6|192,63&s|128):String.fromCharCode(s>>12|224,s>>6&63|128,63&s|128),null!==o&&(i>t&&(a+=e.substring(t,i)),a+=o,t=i=n+1)}return i>t&&(a+=e.substring(t,e.length)),a},S.base64Encode=function(e){var t,i,r,n,a,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=0,u=0,c="",p=[];if(!e)return e;e=S.utf8Encode(e);do{t=(a=e.charCodeAt(o++)<<16|e.charCodeAt(o++)<<8|e.charCodeAt(o++))>>18&63,i=a>>12&63,r=a>>6&63,n=63&a,p[u++]=s.charAt(t)+s.charAt(i)+s.charAt(r)+s.charAt(n)}while(o<e.length);switch(c=p.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c},S.urlSafeBase64=(X={"+":"-","/":"_","=":"."},ee={"-":"+",_:"/",".":"="},{encode:function(e){return e.replace(/[+/=]/g,(function(e){return X[e]}))},decode:function(e){return e.replace(/[-_.]/g,(function(e){return ee[e]}))},trim:function(e){return e.replace(/[.=]{1,2}$/,"")},isBase64:function(e){return/^[A-Za-z0-9+/]*[=]{0,2}$/.test(e)},isUrlSafeBase64:function(e){return/^[A-Za-z0-9_-]*[.]{0,2}$/.test(e)}}),S.btoa=function(e){for(var t,i,r,n,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s="",o=0,u=(e=String(e)).length%3;o<e.length;)((i=e.charCodeAt(o++))>255||(r=e.charCodeAt(o++))>255||(n=e.charCodeAt(o++))>255)&&M.info("Failed to execute 'btoa' : The string to be encoded contains characters outside of the Latin1 range."),s+=a.charAt((t=i<<16|r<<8|n)>>18&63)+a.charAt(t>>12&63)+a.charAt(t>>6&63)+a.charAt(63&t);return u?s.slice(0,u-3)+"===".substring(u):s},S.urlBase64Encode=function(e){return S.btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode("0x"+t)})))},S.rot13obfs=function(e,t){t="number"==typeof t?t:13;for(var i=(e=String(e)).split(""),r=0,n=i.length;r<n;r++){i[r].charCodeAt(0)<126&&(i[r]=String.fromCharCode((i[r].charCodeAt(0)+t)%126))}return i.join("")},S.rot13defs=function(e){return e=String(e),S.rot13obfs(e,113)},S.getCurrentPage=function(){var e={};try{var t=getCurrentPages();e=t[t.length-1]}catch(e){M.info(e)}return e},S.getCurrentPath=function(){var e="未取到";try{var t=S.getCurrentPage();e=t?t.route:e}catch(e){M.info(e)}return e},S.getIsFirstDay=function(){return"object"==typeof e.store._state&&"number"==typeof e.store._state.first_visit_day_time&&e.store._state.first_visit_day_time>(new Date).getTime()},S.getCurrentUrl=function(e){var t=S.getCurrentPath(),i="";return S.isObject(e)&&e.sensors_mp_encode_url_query&&(i=e.sensors_mp_encode_url_query),t?i?t+"?"+i:t:"未取到"},S.getPath=function(e){return e="string"==typeof e?e.replace(/^\//,""):"取值异常"},e.initialState={queue:[],isComplete:!1,systemIsComplete:!1,storeIsComplete:!1,checkIsComplete:function(){this.systemIsComplete&&this.storeIsComplete&&(this.isComplete=!0,this.queue.length>0&&(S.each(this.queue,(function(t){"appLaunch"===t[0]?e.autoTrackCustom.appLaunch.apply(e.autoTrackCustom,S.slice.call(t[1])):e[t[0]].apply(e,S.slice.call(t[1]))})),this.queue=[]))}},S.getCustomUtmFromQuery=function(t,i,r,n){if(!S.isObject(t))return{};var a={};if(t.sa_utm)for(var s in t)"sa_utm"!==s?S.include(e.para.source_channel,s)&&(a[r+s]=t[s]):a[n+s]=t[s];else for(var s in t)-1===" utm_source utm_medium utm_campaign utm_content utm_term ".indexOf(" "+s+" ")?S.include(e.para.source_channel,s)&&(a[r+s]=t[s]):a[i+s]=t[s];return a},S.getObjFromQuery=function(e){var t=e.split("?"),i=[],r={};return t&&t[1]?(S.each(t[1].split("&"),(function(e){(i=e.split("="))[0]&&i[1]&&(r[i[0]]=i[1])})),r):{}},S.setStorageSync=function(e,t){var i=function(){wx.setStorageSync(e,t)};try{i()}catch(e){M.info("set Storage fail --",e);try{i()}catch(e){M.info("set Storage fail again --",e)}}},S.getStorageSync=function(e){var t="";try{t=wx.getStorageSync(e)}catch(i){try{t=wx.getStorageSync(e)}catch(e){M.info("getStorage fail")}}return t},S.getMPScene=function(e){return"number"==typeof e||"string"==typeof e&&""!==e?e="wx-"+String(e):"未取到值"},S.objToParam=function(e,t){if("[object Object]"!==Object.prototype.toString.call(e))return M.info("请传入有效对象"),"";var i=[];for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];void 0===n?i.push(r+"="):(n=t?encodeURIComponent(n):n,i.push(r+"="+n))}return i.join("&")},S.delObjectKey=function(e){if("[object Object]"===Object.prototype.toString.call(e))for(var t=0;t<H.length;t++)delete e[H[t]];else M.info("请传入有效对象")},S.shareInfoData=function(t){var i={},r={};if(e.para.preset_events.share_info_use_string){r=t.query;for(var n=0;n<H.length;n++){if(!r.hasOwnProperty(H[n]))return{};r[H[n]]=S.decodeURIComponent(r[H[n]])}i={depth:Number(r.sensors_share_d),path:r.sensors_share_p||"",id:r.sensors_share_i||"",method:r.sensors_share_m||""}}else{if(!t.query.sampshare)return{};if(r=S.decodeURIComponent(t.query.sampshare),!S.isJSONString(r))return{};i={depth:(r=JSON.parse(r)).d,path:r.p,id:r.i,method:r.m}}return i},S.setShareInfo=function(t,i){var r={},n={},a=e.store.getDistinctId(),s=e.store.getFirstId();if(t&&S.isObject(t.query)){if(r=S.shareInfoData(t),S.isEmptyObject(r))return{};var o=r.depth,u=r.path,c=r.id,p=r.method}"string"==typeof c?(i.$share_distinct_id=c,J=c,n.$latest_share_distinct_id=c):i.$share_distinct_id="取值异常","number"==typeof o?!J||J!==a&&J!==s?!J||J===a&&J===s?i.$share_depth="-1":(i.$share_depth=o+1,z=o+1,n.$latest_share_depth=o+1):(i.$share_depth=o,z=o,n.$latest_share_depth=o):i.$share_depth="-1","string"==typeof u?(i.$share_url_path=u,n.$latest_share_url_path=u):i.$share_url_path="取值异常","string"==typeof p?(i.$share_method=p,n.$latest_share_method=p):i.$share_method="取值异常",S.setLatestShare(n)},S.getShareInfo=function(){if(e.para.preset_events.share_info_use_string){var t={sensors_share_i:e.store.getDistinctId()||"取值异常",sensors_share_p:S.getCurrentPath(),sensors_share_d:z,sensors_share_m:Y};return S.objToParam(t,!0)}var i=JSON.stringify({i:e.store.getDistinctId()||"取值异常",p:S.getCurrentPath(),d:z,m:Y});return"sampshare="+encodeURIComponent(i)},S.detectOptionQuery=function(t){if(!t||!S.isObject(t.query))return{};var i,r,n,a,s={};return s.query=S.extend({},t.query),"string"==typeof s.query.scene&&(i=s.query,r=["utm_source","utm_content","utm_medium","utm_campaign","utm_term","sa_utm"].concat(e.para.source_channel),n=new RegExp("("+r.join("|")+")%3D","i"),1===(a=Object.keys(i)).length&&"scene"===a[0]&&n.test(i.scene))&&(s.scene=s.query.scene,delete s.query.scene),t.query.q&&t.query.scancode_time&&"101"===String(t.scene).slice(0,3)&&(s.q=String(s.query.q),delete s.query.q,delete s.query.scancode_time),s},S.getMixedQuery=function(e){var t=S.detectOptionQuery(e),i=t.scene,r=t.q,n=t.query;for(var a in n)n[a]=S.decodeURIComponent(n[a]);return i&&(i=-1!==(i=S.decodeURIComponent(i)).indexOf("?")?"?"+i.replace(/\?/g,""):"?"+i,S.extend(n,S.getObjFromQuery(i))),r&&S.extend(n,S.getObjFromQuery(S.decodeURIComponent(r))),n},S.setUtm=function(e,t){var i={},r=S.getMixedQuery(e),n=S.getCustomUtmFromQuery(r,"$","_","$"),a=S.getCustomUtmFromQuery(r,"$latest_","_latest_","$latest_");return i.pre1=n,i.pre2=a,S.extend(t,n),i},S.setSfSource=function(t,i){!S.isEmptyObject(t.query)&&t.query._sfs&&(i.$sf_source=t.query._sfs,e.registerApp({$latest_sf_source:i.$sf_source}))},S.setPageSfSource=function(e){try{var t=S.getCurrentPage(),i=t?t.options:"",r=S.deepCopy(i);for(var n in r)r[n]=S.decodeURIComponent(r[n]);!S.isEmptyObject(r)&&r._sfs&&(e.$sf_source=r._sfs)}catch(e){M.info(e)}};try{var ne=wx.setNavigationBarTitle;Object.defineProperty(wx,"setNavigationBarTitle",{get:function(){return function(e){var t=S.getCurrentPath();e=S.isObject(e)?e:{},ie[t]=e.title,ne.call(this,e)}}})}catch(e){M.info(e)}S.setRefPage=function(){var e={route:"直接打开",title:""};try{var t=S.getCurrentPage();if(t&&t.route){var i=t.sensors_mp_url_query?"?"+t.sensors_mp_url_query:"",r=t.route,n=S.getPageTitle(r);e.route=r+i,e.title=n,re.length>=2?(re.shift(),re.push(e)):re.push(e)}}catch(e){M.info(e)}},S.getRefPage=function(){var e={route:"直接打开",title:""};return re.length>1&&(e.title=re[0].title,e.route=re[0].route),e},S.getCurrentPageInfo=function(){var e=S.getCurrentPage(),t={title:"",url:"",path:"未取到"};if(e&&e.route){var i=e.sensors_mp_url_query?"?"+e.sensors_mp_url_query:"";t.title=S.getPageTitle(e.route),t.url=e.route+i,t.path=e.route}return t},S.setPageRefData=function(e,t,i){var r=S.getRefPage();S.isObject(e)&&(t?re.length>0&&t?(i=i?"?"+i:"",e.$referrer=S.getPath(t)+i,e.$referrer_title=S.getPageTitle(t)):(e.$referrer="直接打开",e.$referrer_title=""):(e.$referrer=r.route,e.$referrer_title=r.title))},S.getPageTitle=function(e){if("未取到"===e||!e)return"";var t="";try{if(__wxConfig){var i=__wxConfig,r=__wxConfig.page||{},n=r[e]||r[e+".html"],a={},s={};if(i.global&&i.global.window&&i.global.window.navigationBarTitleText&&(a.titleVal=i.global.window.navigationBarTitleText),n&&n.window&&n.window.navigationBarTitleText&&(s.titleVal=n.window.navigationBarTitleText),!s.titleVal&&__wxAppCode__){var o=__wxAppCode__[e+".json"];o&&o.navigationBarTitleText&&(s.titleVal=o.navigationBarTitleText)}if(S.each(ie,(function(i,r){if(r===e)return t=i})),0===t.length){var u=S.extend(a,s);t=u.titleVal||""}}}catch(e){M.info(e)}return t},S.wxrequest=function(t){if(S.compareSDKVersion(Z,"2.10.0")>=0)t.timeout=e.para.datasend_timeout,wx.request(t);else{var i=wx.request(t);setTimeout((function(){S.isObject(i)&&S.isFunction(i.abort)&&i.abort()}),e.para.datasend_timeout)}},S.getAppInfoSync=function(){if(wx.getAccountInfoSync){var e=wx.getAccountInfoSync(),t=e&&e.miniProgram?e.miniProgram:{};return{appId:t.appId,appEnv:t.envVersion,appVersion:t.version}}return{}},S.getAppId=function(){var e=S.getAppInfoSync();return e&&e.appId?e.appId:""},S.validId=function(e){return"string"!=typeof e&&"number"!=typeof e||""===e?(M.info("输入 ID 类型错误"),!1):"number"!=typeof e||(e=String(e),/^\d+$/.test(e))?!!S.check.ckeckIdLength(e)&&e:(M.info("输入 ID 类型错误"),!1)},S.compareSDKVersion=function(e,t){e=e.split("."),t=t.split(".");for(var i=Math.max(e.length,t.length);e.length<i;)e.push("0");for(;t.length<i;)t.push("0");for(var r=0;r<i;r++){var n=parseInt(e[r]),a=parseInt(t[r]);if(n>a)return 1;if(n<a)return-1}return 0},S.setUpperCase=function(e){return S.isString(e)?e.toLocaleUpperCase():e},S.getOpenidNameByAppid=function(){var e=S.getAppId(),t="$identity_mp_openid";return e&&(t="$identity_mp_"+e+"_openid"),t},S.info={currentProps:{},properties:{$lib:N,$lib_version:String(R)},getSystem:function(){var t=this.properties;function i(){wx.getSystemInfo({success:function(e){var i,r;t.$brand=S.setUpperCase(e.brand),t.$manufacturer=e.brand,t.$model=e.model,t.$screen_width=Number(e.screenWidth),t.$screen_height=Number(e.screenHeight),t.$os=(i=e.platform,"ios"===(r=i.toLowerCase())?"iOS":"android"===r?"Android":i),t.$os_version=e.system.indexOf(" ")>-1?e.system.split(" ")[1]:e.system,Z=e.SDKVersion,t.$mp_client_app_version=e.version,t.$mp_client_basic_library_version=Z},complete:function(){var i=(new Date).getTimezoneOffset(),r=S.getAppInfoSync();S.isNumber(i)&&(t.$timezone_offset=i),r.appId&&(t.$app_id=r.appId),r.appVersion&&(t.$app_version=r.appVersion),e.initialState.systemIsComplete=!0,e.initialState.checkIsComplete()}})}wx.getNetworkType({success:function(e){t.$network_type=S.setUpperCase(e.networkType)},complete:i})}},S.eventEmitter=function(){this.sub=[]},S.eventEmitter.prototype={add:function(e){this.sub.push(e)},emit:function(e,t){this.sub.forEach((function(i){i.on(e,t)}))}},S.eventSub=function(t){e.events.add(this),this._events=[],this.handle=t,this.ready=!1},S.eventSub.prototype={on:function(e,t){if(this.ready){if(S.isFunction(this.handle))try{this.handle(e,t)}catch(e){M.info(e)}}else this._events.push({event:e,data:t})},isReady:function(){var e=this;e.ready=!0,e._events.forEach((function(t){if(S.isFunction(e.handle))try{e.handle(t.event,t.data)}catch(e){M.info(e)}}))}},e.eventSub=S.eventSub,e.events=new S.eventEmitter,e.store={storageInfo:null,store_queue:[],getUUID:function(){return Date.now()+"-"+Math.floor(1e7*l())+"-"+l().toString(16).replace(".","")+"-"+String(31242*l()).replace(".","").slice(0,8)},getStorage:function(){return this.storageInfo||(this.storageInfo=e._.getStorageSync(e.para.storage_store_key)||""),this.storageInfo},_state:{},mem:{mdata:[],getLength:function(){return this.mdata.length},add:function(e){this.mdata.push(e)},clear:function(e){this.mdata.splice(0,e)}},toState:function(e){var t=null;S.isJSONString(e)?(t=JSON.parse(e)).distinct_id?this._state=t:this.set("distinct_id",this.getUUID()):S.isObject(e)&&(t=e).distinct_id?this._state=t:this.set("distinct_id",this.getUUID());var i=this._state._first_id||this._state.first_id,r=this._state._distinct_id||this._state.distinct_id,n=this._state.openid,a=(this._state.history_login_id?this._state.history_login_id:{}).name;if(this._state.identities&&S.isString(this._state.identities)){var s=JSON.parse(S.rot13defs(this._state.identities));this._state.identities=s}var o,u,c=S.getOpenidNameByAppid();if(this._state.identities&&S.isObject(this._state.identities)&&!S.isEmptyObject(this._state.identities)){var p=(o=S.getAppId(),u="$mp_openid",o&&(u="$mp_"+o+"_openid"),u);this._state.identities.hasOwnProperty("$mp_id")&&(this._state.identities.$identity_mp_id=this._state.identities.$mp_id,delete this._state.identities.$mp_id),this._state.identities.hasOwnProperty("$mp_unionid")&&(this._state.identities.$identity_mp_unionid=this._state.identities.$mp_unionid,delete this._state.identities.$mp_unionid),this._state.identities.hasOwnProperty(p)&&(this._state.identities[c]=this._state.identities[p],delete this._state.identities[p]),this._state.identities.hasOwnProperty("$identity_anonymous_id")&&(this._state.identities.$identity_anonymous_id=i||r)}else this._state.identities={},this._state.identities.$identity_mp_id=this.getUUID(),this._state.identities.$identity_anonymous_id=i||r;if(n&&(this._state.identities[c]=n),i)if(a&&this._state.identities.hasOwnProperty(a)){if(this._state.identities[a]!==r){for(var d in this._state.identities[a]=r,this._state.identities)this._state.identities.hasOwnProperty(d)&&"$identity_mp_id"!==d&&d!==a&&delete this._state.identities[d];this._state.history_login_id.value=r}}else{for(var d in this._state.identities[C.user.LOGIN_ID_KEY]=r,this._state.identities)this._state.identities.hasOwnProperty(d)&&"$identity_mp_id"!==d&&d!==C.user.LOGIN_ID_KEY&&delete this._state.identities[d];this._state.history_login_id={name:C.user.LOGIN_ID_KEY,value:r}}else{if(this._state.identities.hasOwnProperty("$identity_login_id")||this._state.identities.hasOwnProperty(a))for(var d in this._state.identities)this._state.identities.hasOwnProperty(d)&&"$identity_mp_id"!==d&&"$identity_anonymous_id"!==d&&delete this._state.identities[d];this._state.history_login_id={name:"",value:""}}this.save()},getFirstId:function(){return this._state._first_id||this._state.first_id},getDistinctId:function(){var e=this.getLoginDistinctId();return e||(this._state._distinct_id||this._state.distinct_id)},getUnionId:function(){var e={},t=this._state._first_id||this._state.first_id,i=this.getDistinctId();return t&&i?(e.login_id=i,e.anonymous_id=t):e.anonymous_id=i,e},getHistoryLoginId:function(){return p(this._state.history_login_id)?this._state.history_login_id:null},getLoginDistinctId:function(){var e=this.getHistoryLoginId();return p(e)&&e.value?e.name!==C.user.LOGIN_ID_KEY?e.name+"+"+e.value:e.value:null},getProps:function(){return this._state.props||{}},setProps:function(e,t){var i=this._state.props||{};t?this.set("props",e):(S.extend(i,e),this.set("props",i))},set:function(t,i){var r={};for(var n in"string"==typeof t?r[t]=i:"object"==typeof t&&(r=t),this._state=this._state||{},r)this._state[n]=r[n],"first_id"===n?delete this._state._first_id:"distinct_id"===n&&(delete this._state._distinct_id,e.events.emit("changeDistinctId"));this.save()},identitiesSet:function(t){var i={};switch(t.type){case"login":i.$identity_mp_id=e.store._state.identities.$identity_mp_id,i[t.id_name]=t.id;break;case"logout":i.$identity_mp_id=e.store._state.identities.$identity_mp_id;break;case"identify":(i=S.deepCopy(e.store._state.identities)).$identity_anonymous_id=t.id}e.store.set("identities",i)},change:function(e,t){this._state["_"+e]=t},encryptStorage:function(){var t=this.getStorage(),i="data:enc;";S.isObject(t)?t=i+S.rot13obfs(JSON.stringify(t)):S.isString(t)&&-1===t.indexOf(i)&&(t=i+S.rot13obfs(t)),e._.setStorageSync(e.para.storage_store_key,t)},save:function(){var t=S.deepCopy(this._state),i=S.rot13obfs(JSON.stringify(t.identities));if(t.identities=i,delete t._first_id,delete t._distinct_id,e.para.encrypt_storage){t="data:enc;"+S.rot13obfs(JSON.stringify(t))}e._.setStorageSync(e.para.storage_store_key,t)},init:function(){var t=this.getStorage();this.session_id=this.getUUID(),this.visitor_id=this.getUUID();var i="data:enc;";if(t)S.isString(t)&&-1!==t.indexOf(i)&&(t=t.substring(i.length),t=JSON.parse(S.rot13defs(t))),this.toState(t);else{W=!0;var r=new Date,n=r.getTime();r.setHours(23),r.setMinutes(59),r.setSeconds(60),e.setOnceProfile({$first_visit_time:new Date}),this.set({distinct_id:this.getUUID(),first_visit_time:n,first_visit_day_time:r.getTime(),identities:{$identity_mp_id:this.getUUID()},history_login_id:{name:"",value:""}})}e.store.checkStoreInit()},checkStoreInit:function(){C.init_status&&(this.store_queue.length>0&&S.each(this.store_queue,(function(t){e[t.method].apply(e,S.slice.call(t.params))})),this.store_queue=[])}},e.setProfile=function(t,i){e.saEvent.send({type:"profile_set",properties:t},i)},e.setOnceProfile=function(t,i){e.saEvent.send({type:"profile_set_once",properties:t},i)},e.appendProfile=function(t,i){if(!S.isObject(t))return!1;S.each(t,(function(e,i){S.isString(e)?t[i]=[e]:(delete t[i],M.info("appendProfile属性的值必须是字符串或者数组"))})),e.saEvent.send({type:"profile_append",properties:t},i)},e.incrementProfile=function(t,i){if(!S.isObject(t))return!1;var r=t;S.isString(t)&&((t={})[r]=1),e.saEvent.send({type:"profile_increment",properties:t},i)},e.track=function(e,t,i){this.saEvent.send({type:"track",event:e,properties:t},i)},e.identify=function(t,i){if(!T())return!1;if(!C.init_status)return e.store.store_queue.push({method:"identify",params:arguments}),!1;if(t=S.validId(t)){var r=e.store.getFirstId();!0===i?r?e.store.set("first_id",t):e.store.set("distinct_id",t):r?e.store.change("first_id",t):e.store.change("distinct_id",t),e.store.identitiesSet({type:"identify",id:t})}},e.trackSignup=function(t,i,r,n){var a,s,o,u;p(t)?(a=t.id,s=t.event_name,o=t.id_name):(a=t,s=i),e.store.set("distinct_id",a),u=o&&o!==C.user.LOGIN_ID_KEY?o+"+"+a:a;var c=e.store.getFirstId()||e.store.getDistinctId();e.saEvent.send({original_id:c,distinct_id:u,login_id:u,type:"track_signup",event:s,properties:r},n)},e.registerApp=function(e){S.isObject(e)&&!S.isEmptyObject(e)&&(S.info.currentProps=S.extend(S.info.currentProps,e))},e.register=function(t){S.isObject(t)&&!S.isEmptyObject(t)&&e.store.setProps(t)},e.clearAllRegister=function(){e.store.setProps({},!0)},e.clearAllProps=function(t){var i=e.store.getProps(),r={};S.isArray(t)&&(S.each(i,(function(e,i){S.include(t,i)||(r[i]=e)})),e.store.setProps(r,!0))},e.clearAppRegister=function(e){S.isArray(e)&&S.each(S.info.currentProps,(function(t,i){S.include(e,i)&&delete S.info.currentProps[i]}))},S.setLatestChannel=function(t){S.isEmptyObject(t)||(function(e,t){var i=!1;for(var r in t)e[t[r]]&&(i=!0);return i}(t,K)&&(e.clearAppRegister(K),e.clearAllProps(K)),e.para.is_persistent_save.utm?e.register(t):e.registerApp(t))},S.setLatestShare=function(t){(t.$latest_share_depth||t.$latest_share_distinct_id||t.$latest_share_url_path||t.$latest_share_method)&&(e.clearAppRegister(B),e.clearAllProps(B),e.para.is_persistent_save.share?e.register(t):e.registerApp(t))},e.login=function({userId:t,userName:i=""}){let r=S.validId(t);if(!r)return!1;if(E(r))return!1;var n=e.store.getFirstId(),a=e.store.getDistinctId(),s=C.user.LOGIN_ID_KEY;L(s,r)&&(e.store._state.identities[s]=r,e.store.set("history_login_id",{name:s,value:r,userName:i}),n||e.store.set("first_id",a),e.trackSignup({id:r,event_name:"$SignUp"}),e.store.identitiesSet({type:"login",id:r,id_name:s}))},e.loginWithKey=function(t,i){if(!S.isString(t))return M.info("Key must be String"),!1;if(!S.check.checkKeyword(t)&&t.length>100)r="Key ["+t+"] is invalid",M.info(r);else if(!S.check.checkKeyword(t))return r="Key ["+t+"] is invalid",M.info(r),!1;if(F(t,["$mp_id","$identity_mp_id"])){var r="Key ["+t+"] is invalid";return M.info(r),!1}if(!(i=S.validId(i)))return!1;if(E(i))return!1;var n=e.store.getFirstId(),a=e.store.getDistinctId();L(t,i)&&(e.store._state.identities[t]=i,e.store.set("history_login_id",{name:t,value:i}),n||e.store.set("first_id",a),e.trackSignup({id:i,event_name:"$SignUp",id_name:t}),e.store.identitiesSet({type:"login",id:i,id_name:t}))},e.getAnonymousID=function(){if(!S.isEmptyObject(e.store._state))return e.store._state._first_id||e.store._state.first_id||e.store._state._distinct_id||e.store._state.distinct_id;M.info("请先初始化SDK")},e.getIdentities=function(){return S.isEmptyObject(e.store._state)?(M.info("请先初始化SDK"),null):e.store._state.identities||null},e.logout=function(t){var i=e.store.getFirstId();e.store.identitiesSet({type:"logout"}),e.store.set("history_login_id",{name:"",value:""}),i?(e.store.set("first_id",""),!0===t?e.store.set("distinct_id",e.store.getUUID()):e.store.set("distinct_id",i)):M.info("没有first_id，logout失败")},e.openid={getRequest:function(t){wx.login({success:function(i){i.code&&e.para.appid&&e.para.openid_url?S.wxrequest({url:e.para.openid_url+"&code="+i.code+"&appid="+e.para.appid,method:"GET",complete:function(e){S.isObject(e)&&S.isObject(e.data)&&e.data.openid?t(e.data.openid):t()}}):t()}})},getWXStorage:function(){var t=e.store.getStorage();if(t&&S.isObject(t))return t.openid},getOpenid:function(t){if(!e.para.appid)return t(),!1;var i=this.getWXStorage();i?t(i):this.getRequest(t)}},e.init=function(t){if(!0===C.init_status)return!1;C.init_status=!0,t&&S.isObject(t)&&e.setPara(t),e.store.init(),e._.info.getSystem(),e.checkPluginInitStatus(),e.para.batch_send&&O.init(),e.initialState.storeIsComplete=!0,e.initialState.checkIsComplete(),function(){if(!C.life_state.app_launched){var t=wx.getLaunchOptionsSync()||{};e.autoTrackCustom.appLaunch(t)}}()},e.getPresetProperties=function(){if(S.info&&S.info.properties&&S.info.properties.$lib){var t={};S.each(S.info.currentProps,(function(e,i){0===i.indexOf("$")&&(t[i]=e)}));var i={$url_path:S.getCurrentPath(),$is_first_day:S.getIsFirstDay(),$is_first_time:W},r=S.extend(t,i,S.info.properties,e.store.getProps());return delete r.$lib,r}return{}},e.setOpenid=function(t,i){if(!(t=S.validId(t)))return!1;if(!T())return!1;if(!C.init_status)return e.store.store_queue.push({method:"setOpenid",params:arguments}),!1;i&&console.log("%c 当前版本 setOpenid 接口 已不支持传入第二个参数","color:#F39C12;font-size: 14px;"),e.store.set("openid",t),e.identify(t,!0);var r=S.getOpenidNameByAppid();e.store._state.identities[r]=t,e.store.save()},e.unsetOpenid=function(t){var i=S.validId(t);if(!i)return!1;e.store._state.openid===i&&e.store.set("openid","");var r=S.getOpenidNameByAppid();e.store._state.identities.hasOwnProperty(r)&&i===e.store._state.identities[r]&&(delete e.store._state.identities[r],e.store.save())},e.setUnionid=function(t){var i=S.validId(t);i&&(e.store._state.identities.$identity_mp_unionid=i,e.store.save())},e.unsetUnionid=function(t){var i=S.validId(t);if(i&&e.store._state.identities.hasOwnProperty("$identity_mp_unionid")&&i===e.store._state.identities.$identity_mp_unionid){var r=S.getOpenidNameByAppid();e.store._state.identities.hasOwnProperty(r)&&(delete e.store._state.identities[r],delete e.store._state.openid,e.store.save()),delete e.store._state.identities.$identity_mp_unionid,e.store.save()}},e.initWithOpenid=function(t,i){(t=t||{}).appid&&(e.para.appid=t.appid),e.openid.getOpenid((function(r){r&&e.setOpenid(r,t.isCoverLogin),i&&S.isFunction(i)&&i(r),e.init(t)}))},e.bind=function(t,i){if(S.isNumber(i)){if(S.isInteger(i)&&!1===S.isSafeInteger(i))return M.info("Value must be String"),!1;i=String(i)}if(!S.isString(t))return M.info("Key must be String"),!1;var r=e.store.getHistoryLoginId(),n=r?r.name:"";if(!S.check.checkKeyword(t)||F(t,[C.user.LOGIN_ID_KEY,n,"$mp_id","$identity_mp_id"])){var a="Key ["+t+"] is invalid";return M.info(a),!1}if(!i||""===i)return M.info("Value is empty or null"),!1;if(!S.isString(i))return M.info("Value must be String"),!1;if(!S.check.ckeckIdLength(i)){a="Value ["+i+"] is beyond the maximum length 255";return M.info(a),!1}e.store._state.identities[t]=i,e.store.save(),e.saEvent.send({type:"track_id_bind",event:"$BindID"})},e.unbind=function(t,i){if(S.isNumber(i)){if(S.isInteger(i)&&!1===S.isSafeInteger(i))return M.info("Value must be String"),!1;i=String(i)}if(!S.isString(t))return M.info("Key must be String"),!1;if(!S.check.checkKeyword(t)||F(t,[C.user.LOGIN_ID_KEY])){var r="Key ["+t+"] is invalid";return M.info(r),!1}if(!i||""===i)return M.info("Value is empty or null"),!1;if(!S.isString(i))return M.info("Value must be String"),!1;if(!S.check.ckeckIdLength(i)){r="Value ["+i+"] is beyond the maximum length 255";return M.info(r),!1}e.store._state.identities.hasOwnProperty(t)&&i===e.store._state.identities[t]&&("$mp_id"!==t&&"$identity_mp_id"!==t&&delete e.store._state.identities[t],e.store.save());var n=e.store.getDistinctId(),a=e.store.getFirstId();n===t+"+"+i&&(e.store.set("first_id",""),e.store.set("distinct_id",a),e.store.set("history_login_id",{name:"",value:""}));var s={};s[t]=i,e.saEvent.send({type:"track_id_unbind",event:"$UnbindID",unbind_value:s})},e.setWebViewUrl=function(t,i){if(!S.isString(t)||""===t)return M.info("error:请传入正确的 URL 格式"),!1;if(!/^http(s)?:\/\//.test(t))return M.info("warning: 请传入正确的 URL 格式"),!1;var r=/([^?#]+)(\?[^#]*)?(#.*)?/.exec(t);if(!r)return!1;var n,a=r[1]||"",s=r[2]||"",o=r[3]||"",u="",c=e.store.getDistinctId()||"",p=e.store.getFirstId()||"";S.urlSafeBase64&&S.urlSafeBase64.encode?c=c?S.urlSafeBase64.trim(S.urlSafeBase64.encode(S.urlBase64Encode(c))):"":this._.rot13obfs&&(c=c?S.rot13obfs(c):""),c=encodeURIComponent(c);var d=p?"f"+c:"d"+c;i?(n=o.indexOf("_sasdk"),u=o.indexOf("?")>-1?n>-1?a+s+"#"+o.substring(1,n)+"_sasdk="+d:a+s+"#"+o.substring(1)+"&_sasdk="+d:a+s+"#"+o.substring(1)+"?_sasdk="+d):(n=s.indexOf("_sasdk"),u=/^\?(\w)+/.test(s)?n>-1?a+s.replace(/(_sasdk=)([^&]*)/gi,"_sasdk="+d)+o:a+"?"+s.substring(1)+"&_sasdk="+d+o:a+"?"+s.substring(1)+"_sasdk="+d+o);return u},S.each(["setProfile","setOnceProfile","track","quick","incrementProfile","appendProfile","login","logout","registerApp","register","clearAllRegister","clearAllProps","clearAppRegister","bind","unbind","unsetOpenid","setUnionid","unsetUnionid"],(function(t){var i=e[t];e[t]=function(){if(!T())return!1;e.initialState.isComplete?i.apply(e,arguments):e.initialState.queue.push([t,arguments])}})),S.setQuery=function(e,t){if(e&&S.isObject(e)&&!S.isEmptyObject(e)){var i=[];return S.each(e,(function(e,r){"q"===r&&S.isString(e)&&0===e.indexOf("http")||(t?i.push(r+"="+e):i.push(r+"="+S.decodeURIComponent(e)))})),i.join("&")}return""},S.getUtmFromPage=function(){var e={};try{var t=S.getCurrentPage(),i=S.deepCopy(t.options);for(var r in i)i[r]=S.decodeURIComponent(i[r]);e=S.getCustomUtmFromQuery(i,"$","_","$")}catch(e){M.info(e)}return e},S.sendPageLeave=function(){var t={},i="";try{i=(t=S.getCurrentPage())?t.route:""}catch(e){M.info(e)}if(V>=0&&""!==i){var r={},n=S.getPageTitle(i),a=(Date.now()-V)/1e3;(isNaN(a)||a<0)&&(a=0),r.$url_query=t.sensors_mp_url_query?t.sensors_mp_url_query:"",r.$url_path=i,r.$title=n,r.event_duration=a,-1===e.para.autotrack_exclude_page.pageLeave.indexOf(i)&&e.track("$MPPageLeave",r),V=-1}},e.autoTrackCustom={trackCustom:function(t,i,r){var n=e.para.autoTrack[t],a="";e.para.autoTrack&&n&&("function"==typeof n?(a=n(),S.isObject(a)&&S.extend(i,a)):S.isObject(n)&&(S.extend(i,n),e.para.autoTrack[t]=!0),e.track(r,i))},appLaunch:function(t,i){if("object"!=typeof this||this.trackCustom||(this[e.para.name]=e),!T())return!1;if(!e.initialState.isComplete)return e.initialState.queue.push(["appLaunch",arguments]),C.life_state.app_launched=!0,!1;C.life_state.app_launched=!0;var r={};if(t&&t.scene?(G=t.scene,e.current_scene=G,r.$scene=S.getMPScene(t.scene)):r.$scene="未取到值",t&&t.scene&&1010===t.scene&&t.query&&(t.query.sampshare&&delete t.query.sampshare,S.delObjectKey(t.query)),t&&t.path&&(r.$url_path=S.getPath(t.path),r.$title=S.getPageTitle(t.path),t.query&&S.isObject(t.query))){var n=S.setQuery(t.query);n=n?"?"+n:"",r.$url=r.$url_path+n}S.setShareInfo(t,r);var a=S.setUtm(t,r);W?(r.$is_first_time=!0,S.isEmptyObject(a.pre1)||e.setOnceProfile(a.pre1)):r.$is_first_time=!1,S.setLatestChannel(a.pre2),S.setSfSource(t,r),e.registerApp({$latest_scene:r.$scene}),r.$url_query=S.setQuery(t.query),S.setPageRefData(r),i?(r=S.extend(r,i),e.track("$MPLaunch",r)):e.para.autoTrack&&e.para.autoTrack.appLaunch&&e.autoTrackCustom.trackCustom("appLaunch",r,"$MPLaunch")},appShow:function(t,i){var r={};Q=(new Date).getTime(),t&&t.scene?(G=t.scene,e.current_scene=G,r.$scene=S.getMPScene(t.scene)):r.$scene="未取到值",t&&t.scene&&1010===t.scene&&t.query&&(t.query.sampshare&&delete t.query.sampshare,S.delObjectKey(t.query)),t&&t.path&&(r.$url_path=S.getPath(t.path),r.$title=S.getPageTitle(t.path)),S.setShareInfo(t,r);var n=S.setUtm(t,r);S.setLatestChannel(n.pre2),S.setSfSource(t,r),e.registerApp({$latest_scene:r.$scene}),r.$url_query=S.setQuery(t.query),S.setPageRefData(r,t.path,r.$url_query),t&&t.path&&(r.$url=t.path+(r.$url_query?"?"+r.$url_query:"")),i?(r=S.extend(r,i),e.track("$MPShow",r)):e.para.autoTrack&&e.para.autoTrack.appShow&&e.autoTrackCustom.trackCustom("appShow",r,"$MPShow")},appHide:function(t){var i=(new Date).getTime(),r={};r.$url_path=S.getCurrentPath(),Q&&i-Q>0&&(i-Q)/36e5<24&&(r.event_duration=(i-Q)/1e3),S.setPageRefData(r),t?(r=S.extend(r,t),e.track("$MPHide",r)):e.para.autoTrack&&e.para.autoTrack.appHide&&e.autoTrackCustom.trackCustom("appHide",r,"$MPHide"),O.onAppHide()},pageLoad:function(e){G&&1010===G&&e&&(e.sampshare&&delete e.sampshare,S.delObjectKey(e)),e&&S.isObject(e)&&(this.sensors_mp_url_query=S.setQuery(e),this.sensors_mp_encode_url_query=S.setQuery(e,!0))},pageShow:function(){V=Date.now();var t={},i=S.getCurrentPath(),r=S.getPageTitle(i);S.setRefPage(),t.$url_path=i,t.$url_query=this.sensors_mp_url_query?this.sensors_mp_url_query:"",t=S.extend(t,S.getUtmFromPage()),S.setPageRefData(t),S.setPageSfSource(t),r&&(t.$title=r),e.para.onshow?e.para.onshow(e,i,this):-1===e.para.autotrack_exclude_page.pageShow.indexOf(i)&&e.autoTrackCustom.trackCustom("pageShow",t,"$MPViewScreen")},pageShare:function(t){var i=t.onShareAppMessage;t.onShareAppMessage=function(){Y="转发消息卡片";var t=i.apply(this,arguments);if(e.para.autoTrack&&e.para.autoTrack.pageShare){var r={$url_path:S.getCurrentPath(),$share_depth:z,$share_method:Y};S.setPageRefData(r),e.autoTrackCustom.trackCustom("pageShare",r,"$MPShare")}return e.para.allow_amend_share_path&&("object"!=typeof t&&((t={}).path=S.getCurrentUrl(this)),"object"!=typeof t||void 0!==t.path&&""!==t.path||(t.path=S.getCurrentUrl(this)),"object"==typeof t&&"string"==typeof t.path&&(-1===t.path.indexOf("?")?t.path=t.path+"?":"&"!==t.path.slice(-1)&&(t.path=t.path+"&")),t.path=t.path+S.getShareInfo()),t}},pageShareTimeline:function(t){var i=t.onShareTimeline;t.onShareTimeline=function(){Y="朋友圈分享";var t=i.apply(this,arguments);if(e.para.autoTrack&&e.para.autoTrack.pageShare){var r={$url_path:S.getCurrentPath(),$share_depth:z,$share_method:Y};S.setPageRefData(r),e.autoTrackCustom.trackCustom("pageShare",r,"$MPShare")}return e.para.allow_amend_share_path&&("object"!=typeof t&&(t={}),"object"==typeof t&&void 0===t.query&&(t.query=""),"object"==typeof t&&"string"==typeof t.query&&""!==t.query&&"&"!==t.query.slice(-1)&&(t.query=t.query+"&"),t.query=t.query+S.getShareInfo()),t}},pageAddFavorites:function(){var t={};t.$url_path=S.getCurrentPath(),e.para.autoTrack&&e.para.autoTrack.mpFavorite&&e.autoTrackCustom.trackCustom("mpFavorite",t,"$MPAddFavorites")}},e.quick=function(){var t=arguments[0],i=arguments[1],r=arguments[2],n=S.isObject(r)?r:{};if("getAnonymousID"===t){if(!S.isEmptyObject(e.store._state))return e.store._state._first_id||e.store._state.first_id||e.store._state._distinct_id||e.store._state.distinct_id;M.info("请先初始化SDK")}else"appLaunch"===t||"appShow"===t?i?e.autoTrackCustom[t](i,n):M.info("App的launch和show，在sensors.quick第二个参数必须传入App的options参数"):"appHide"===t&&(n=S.isObject(i)?i:{},e.autoTrackCustom[t](n))},e.appLaunch=function(t,i){var r={};t&&t.scene?(G=t.scene,e.current_scene=G,r.$scene=S.getMPScene(t.scene)):r.$scene="未取到值",t&&t.scene&&1010===t.scene&&t.query&&(t.query.sampshare&&delete t.query.sampshare,S.delObjectKey(t.query)),t&&t.path&&(r.$url_path=S.getPath(t.path),r.$title=S.getPageTitle(t.path)),S.setShareInfo(t,r);var n=S.setUtm(t,r);W?(r.$is_first_time=!0,S.isEmptyObject(n.pre1)||e.setOnceProfile(n.pre1)):r.$is_first_time=!1,S.setLatestChannel(n.pre2),S.setSfSource(t,r),e.registerApp({$latest_scene:r.$scene}),r.$url_query=S.setQuery(t.query),r.$url=t.path+(r.$url_query?"?"+r.$url_query:""),S.setPageRefData(i),S.isObject(i)&&(r=S.extend(r,i)),e.track("$MPLaunch",r)},e.appShow=function(t,i){var r={};Q=(new Date).getTime(),t&&t.scene?(G=t.scene,e.current_scene=G,r.$scene=S.getMPScene(t.scene)):r.$scene="未取到值",t&&t.scene&&1010===t.scene&&t.query&&(t.query.sampshare&&delete t.query.sampshare,S.delObjectKey(t.query)),t&&t.path&&(r.$url_path=S.getPath(t.path),r.$title=S.getPageTitle(t.path)),S.setShareInfo(t,r);var n=S.setUtm(t,r);S.setLatestChannel(n.pre2),S.setSfSource(t,r),e.registerApp({$latest_scene:r.$scene}),r.$url_query=S.setQuery(t.query),t&&t.path&&(r.$url=t.path+(r.$url_query?"?"+r.$url_query:"")),S.setPageRefData(r,t.path,r.$url_query),S.isObject(i)&&(r=S.extend(r,i)),e.track("$MPShow",r)},e.appHide=function(t){var i=(new Date).getTime(),r={};r.$url_path=S.getCurrentPath(),Q&&i-Q>0&&(i-Q)/36e5<24&&(r.event_duration=(i-Q)/1e3),S.setPageRefData(r),S.isObject(t)&&(r=S.extend(r,t)),e.track("$MPHide",r),O.onAppHide()},e.pageShow=function(t){var i={},r=S.getCurrentPath(),n=S.getPageTitle(r),a=S.getCurrentPage();S.setRefPage(),n&&(i.$title=n),i.$url_path=r,i.$url_query=a.sensors_mp_url_query?a.sensors_mp_url_query:"",i=S.extend(i,S.getUtmFromPage()),S.setPageSfSource(i),S.setPageRefData(i),S.isObject(t)&&(i=S.extend(i,t)),e.track("$MPViewScreen",i)},te=App,App=function(t){t[e.para.name]=e,te.apply(this,arguments)},wx.onAppShow((function(t){if(!C.life_state.app_launched){var i=wx.getLaunchOptionsSync()||{};e.autoTrackCustom.appLaunch(i)}e.autoTrackCustom.appShow(t)})),wx.onAppHide((function(){e.autoTrackCustom.appHide()})),function(){var e=Page;Page=function(t){try{t||(t={}),A(t),U(t),e.apply(this,arguments)}catch(t){e.apply(this,arguments)}};var t=Component;Component=function(e){try{e||(e={}),e.methods||(e.methods={}),A(e.methods),U(e.methods),t.apply(this,arguments)}catch(e){t.apply(this,arguments)}}}(),module.exports=e}();
